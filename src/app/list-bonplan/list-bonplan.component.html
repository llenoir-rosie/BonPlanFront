<!DOCTYPE html>
  <html>                        
    <head>                        
      <title>BonPlan</title>                        
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">    
      <link href='https://css.gg/css' rel='stylesheet'>                  
    </head> 
    <body>            
      <div class="row">
        <div class = "col card-bp">
          <div class="gros-titre">
            <h1>Les bons plans</h1>
          </div>
          <div class="en-tete-card">
            <button *ngIf="allowModeratorRight || allowUserRight" mat-raised-button class="waves-effect waves-light btn btn-bp"
            (click)="goToFormAddBonPlan()" style="color:wheat; background-color: black;">&nbsp; Nouveau Plan
            <i class="material-icons right" style="font-size: 23px;">add_circle_outline</i>
            </button>
            <div class="choix-tri">
              <label for="DropdownOptions">Trier par:</label>
              <select class="form-control" id="DropdownOptions" (click)="Trie1()" >
                <option
                  *ngFor="let opt of ngOptions"
                  [selected]="opt === ngDropdown"
                  [value]="opt" >{{ opt }}
                </option>
              </select>
            </div>
          </div>
          <div *ngFor="let bp of allBonPlanFiltered">
            <div class="card" testBorderCard = 'setHeight=50'> <!--(click)="deleteBonPlan(nomdelaville, nomdelactivite)"-->
              <div class="card-content-bp">
                <div class="left-content">
                  <h2>{{ bp.name }}</h2>
                  <div class="row-avis-date">
                    <p *ngIf="bp.note.length == 0 ">(pas encore d'avis)</p>
                    <div class="notation" *ngIf="!(bp.note.length == 0)"> {{moyenneTableau(bp.note)}}
                      <div *ngIf="moyenneTableau(bp.note) < '2.3'" class="notation">
                        <i class="material-icons notation_étoile" style="font-size: 20px; color: red">
                          star
                        </i> <i> ({{bp.note.length}} avis) </i>
                      </div>
                      <div *ngIf="moyenneTableau(bp.note) > '3.7'" class="notation">
                        <i class="material-icons notation_étoile" style="font-size: 20px; color: green">
                          star
                        </i> <i> ({{bp.note.length}} avis) </i>
                      </div>
                      <div *ngIf="moyenneTableau(bp.note) >= '2.3' && moyenneTableau(bp.note) <= '3.7' " class="notation">
                        <i class="material-icons notation_étoile" style="font-size: 20px; color: orange">
                          star
                        </i> <i> ({{bp.note.length}} avis) </i>
                      </div>
                    </div>

                    <div class="separator">
                    </div>
                    <div class="date-bp">
                      <p>il y a {{getDateCreaBp(bp.date)[0]}} {{getDateCreaBp(bp.date)[1]}}</p>
                    </div>
                  </div>
                  

                    <hr style="margin-top: 3%; margin-bottom: 3%;">
                    <p>{{ bp.address }}</p> 
                    <hr style="margin-top: 3%; margin-bottom: 3%;">
                    <p class="commentaryBtn"> 
                      <button *ngIf = 'bp.allCommentaries.length > 1 '(click)="openDialogCommentaries(openCommentaries, bp.name)" >{{bp.allCommentaries.length}} Commentaires </button>
                      <button *ngIf = 'bp.allCommentaries.length == 1 || bp.allCommentaries.length == 0'(click)="openDialogCommentaries(openCommentaries, bp.name)" >{{bp.allCommentaries.length}} Commentaire </button>
                    </p>
                    <!-- <p><i class="material-icons" (click)="openDialogWithTemplateRef(addACommentary)" style="font-size: 23px;">add_circle</i>ajouter un commentaire</p> -->
                    <ng-template  #openCommentaries >
                      <div class="content-ngtemplate" style="background:none;">
                        <h2 class = "titre"> Commentaires </h2>
                        <div mat-dialog-content>
                          <div *ngIf = "bp.allCommentaries.length != 0">
                            <p *ngFor="let com of allCommentary" >
                              <mat-card>
                                <mat-card-header>
                                  <mat-card-subtitle>{{com.userName}}</mat-card-subtitle>
                                </mat-card-header>
                                <mat-card-content>{{ com.commentaries }} </mat-card-content>
                              </mat-card>
                            </p>
                          </div>
                          <div *ngIf = "bp.allCommentaries.length == 0">
                            <p> aucun commentaire </p>
                          </div>
                          <div class="commentary">
                            <label for="new_commentary">Partagez votre expérience : </label>
                            <textarea  *ngIf="bp.already_noted == 'false'" style="height: 50px;" id="new_commentary" name="new_commentary"></textarea>
                            <p *ngIf="bp.already_noted == 'true'"> Experience déjà partagée</p>
                          </div>
                        </div>
                        <div mat-dialog-actions class = "button-bottom">
                          <button *ngIf="bp.already_noted == 'false'" class="BtnValider" (click)="addCommentary(bp)"> Ajouter </button>
                          <button *ngIf="bp.already_noted == 'true'" class="BtnValider"  disabled style="opacity: 0.5"> Ajouter </button>
                          <button class="BtnAnnuler" matDialogClose > Annuler </button>
                        </div>
                      </div>
                    </ng-template>


                    <!-- <ng-template  #addACommentary >
                      <div class="content-ngtemplate" >
                        <h2 class = "titre">Que pensez vous de ce conseil ? </h2>
                        <div mat-dialog-content>
                          <div class="commentary">
                            <label for="new_commentary">Commentaire : </label>
                            <textarea style="height: 100px;" id="new_commentary" name="new_commentary"></textarea>
                          </div>
                        </div>
                        <div mat-dialog-actions class = "button-bottom">
                          <button class="BtnValider" (click)="addCommentary(bp.name)"> Ajouter </button>
                          <button class="BtnAnnuler" matDialogClose > Annuler </button>
                        </div>
                      </div>
                    </ng-template> -->
                    <hr style="margin-top: 3%; margin-bottom: 3%;">
                    <div *ngIf="bp.already_noted == 'false'" class="rating">Laissez-nous votre avis ! &#160;
                      <div>
                         <a id="étoile5" (click)="noteClick('5', bp.note, bp.name, bp.address, bp.note_user)" title="Donner 5 étoiles">☆</a><!--
                      --><a id="étoile4" (click)="noteClick('4', bp.note, bp.name, bp.address, bp.note_user)" title="Donner 4 étoiles">☆</a><!--
                      --><a id="étoile3" (click)="noteClick('3', bp.note, bp.name, bp.address, bp.note_user)" title="Donner 3 étoiles">☆</a><!--
                      --><a id="étoile2" (click)="noteClick('2', bp.note, bp.name, bp.address, bp.note_user)" title="Donner 2 étoiles">☆</a><!--
                      --><a id="étoile1" (click)="noteClick('1', bp.note, bp.name, bp.address, bp.note_user)" title="Donner 1 étoile">☆</a>
                      </div>
                    </div>
                    <div *ngIf = "bp.already_noted == 'true'" >
                      <p class="information_call_note"> <i class="material-icons">check</i> La communauté BonPlan vous remercie pour cet avis !!</p>
                    </div>
                  </div>
                  <img class = "img-test" src="{{currentImg}}">
                  <!-- Enlever allowUserRight quand on aura plusieurs utilisateurs (le modérateur peut tout faire et le user peut modifier
                  ses bp )-->
                  <i *ngIf="(allowModeratorRight || currentUser == bp.user_name)" id='trashBtn' class='fa fa-trash' (click)="deleteBonPlan(bp.name)"></i> 
                  <i *ngIf="(allowModeratorRight || currentUser == bp.user_name)" id='editBtn' class="gg-edit-markup" aria-hidden="false" (click)="updateBonPlan(bp)"></i>
                </div>     
            </div> 
          </div>
        </div>

        <div class = "col card-mp">
          <div class="gros-titre">
            <h1>Les mauvais plans</h1>
          </div>
          <div class="en-tete-card">
            <!-- <button *ngIf="allowModeratorRight || allowUserRight" mat-raised-button class="waves-effect waves-light btn btn-bp"
            (click)="goToFormAddBonPlan()" style="color:wheat; background-color: black;">&nbsp; Nouveau Plan
            <i class="material-icons right" style="font-size: 23px;">add_circle_outline</i>
            </button> -->
            <div class="choix-tri">
              <label for="DropdownOptions">Trier par:</label>
              <select class="form-control" id="DropdownOptions2" (click)="Trie2()" >
                <option
                  *ngFor="let opt of ngOptions2"
                  [selected]="opt === ngDropdown2"
                  [value]="opt" >{{ opt }}
                </option>
              </select>
            </div>
          </div>
          <div *ngFor="let bp of allMauvaisPlanFiltered">
            <div class="card"> <!--(click)="deleteBonPlan(nomdelaville, nomdelactivite)"-->
                <div class="card-content-mp">
                  <div class="left-content">
                    <h2>{{ bp.name }}</h2>
                    <div class="row-avis-date">

                      <p *ngIf="bp.note.length == 0 ">(pas encore d'avis)</p>
                      <div class="notation" *ngIf="!(bp.note.length == 0)"> {{moyenneTableau(bp.note)}}
                        <div *ngIf="moyenneTableau(bp.note) < '2.3'" class="notation">
                          <i class="material-icons notation_étoile" style="font-size: 20px; color: red">
                            star
                          </i> <i> ({{bp.note.length}} avis) </i>
                        </div>
                        <div *ngIf="moyenneTableau(bp.note) > '3.7'" class="notation">
                          <i class="material-icons notation_étoile" style="font-size: 20px; color: green">
                            star
                          </i> <i> ({{bp.note.length}} avis) </i>
                        </div>
                        <div *ngIf="moyenneTableau(bp.note) >= '2.3' && moyenneTableau(bp.note) <= '3.7' " class="notation">
                          <i class="material-icons notation_étoile" style="font-size: 20px; color: orange">
                            star
                          </i> <i> ({{bp.note.length}} avis) </i>
                        </div>
                        <div class="separator">
                        </div>
                        <div class="date-bp">
                          <p>il y a {{getDateCreaBp(bp.date)[0]}} {{getDateCreaBp(bp.date)[1]}}</p>
                        </div>
                    </div>
                    
                    </div>
                    <hr style="margin-top: 3%; margin-bottom: 3%;">
                    <p>{{ bp.address }}</p>
                    <hr style="margin-top: 3%; margin-bottom: 3%;">
                    <p class="commentaryBtn"> 
                      <button *ngIf = 'bp.allCommentaries.length > 1 '(click)="openDialogCommentaries(openCommentaries, bp.name)" >{{bp.allCommentaries.length}} Commentaires </button>
                      <button *ngIf = 'bp.allCommentaries.length == 1 || bp.allCommentaries.length == 0'(click)="openDialogCommentaries(openCommentaries, bp.name)" >{{bp.allCommentaries.length}} Commentaire </button>
                    </p>
                    <ng-template  #openCommentaries >
                      <div class="content-ngtemplate" style="background:none;">
                        <h2 class = "titre"> Commentaires </h2>
                        <div mat-dialog-content>
                          <div *ngIf = "bp.allCommentaries.length != 0">
                            <p *ngFor="let com of allCommentary" >
                              <mat-card>
                                <mat-card-header>
                                  <mat-card-subtitle>{{com.userName}}</mat-card-subtitle>
                                </mat-card-header>
                                <mat-card-content>{{ com.commentaries }} </mat-card-content>
                              </mat-card>
                            </p>
                          </div>
                          <div *ngIf = "bp.allCommentaries.length == 0">
                            <p> aucun commentaire </p>
                          </div>
                          <div class="commentary">
                            <label for="new_commentary">Partagez votre expérience : </label>
                            <textarea  *ngIf="bp.already_noted == 'false'" style="height: 50px;" id="new_commentary" name="new_commentary"></textarea>
                            <p *ngIf="bp.already_noted == 'true'"> Experience déjà partagée</p>
                          </div>
                        </div>
                        <div mat-dialog-actions class = "button-bottom">
                          <button *ngIf="bp.already_noted == 'false'" class="BtnValider" (click)="addCommentary(bp)"> Ajouter </button>
                          <button *ngIf="bp.already_noted == 'true'" class="BtnValider" disabled style="opacity: 0.5"> Ajouter </button>
                          <button class="BtnAnnuler" matDialogClose > Annuler </button>
                        </div>
                      </div>
                    </ng-template>
                    <hr style="margin-top: 3%; margin-bottom: 3%;">
                    <div *ngIf="bp.already_noted == 'false'" class="rating">Laissez-nous votre avis ! &#160;
                      <div>
                         <a id="étoile5" (click)="noteClick('5', bp.note, bp.name, bp.address, bp.note_user)" title="Donner 5 étoiles">☆</a><!--
                      --><a id="étoile4" (click)="noteClick('4', bp.note, bp.name, bp.address, bp.note_user)" title="Donner 4 étoiles">☆</a><!--
                      --><a id="étoile3" (click)="noteClick('3', bp.note, bp.name, bp.address, bp.note_user)" title="Donner 3 étoiles">☆</a><!--
                      --><a id="étoile2" (click)="noteClick('2', bp.note, bp.name, bp.address, bp.note_user)" title="Donner 2 étoiles">☆</a><!--
                      --><a id="étoile1" (click)="noteClick('1', bp.note, bp.name, bp.address, bp.note_user)" title="Donner 1 étoile">☆</a>
                      </div>
                    </div>
                    <div *ngIf = "bp.already_noted == 'true'" >
                      <p class="information_call_note"> <i class="material-icons">check</i> La communauté BonPlan vous remercie pour cet avis !!</p>
                    </div>
                    <!-- <div *ngIf="bp.already_noted == 'false' ">
                      Bon Plan déjà noté
                    </div> -->
                  </div>
                  <img class = "img-test" src="{{currentImg}}">
                  <!-- Enlever allowUserRight quand on aura plusieurs utilisateurs (le modérateur peut tout faire et le user peut modifier
                  ses bp )-->
                  <i *ngIf="(allowModeratorRight || currentUser == bp.user_name)" id='trashBtn' class='fa fa-trash' (click)="deleteBonPlan(bp.name)"></i> 
                  <i *ngIf="(allowModeratorRight || currentUser == bp.user_name)" id='editBtn' class="gg-edit-markup" aria-hidden="false" (click)="updateBonPlan(bp)"></i>
                </div>     
            </div> 
          </div>
        </div>
      </div>
    </body>
  </html>
 